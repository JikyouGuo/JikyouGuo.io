var root=window.player,dataList=[],len=0,audio=root.audioManager,contolIndex=null,timer=null;function getData(t){$.ajax({type:"GET",url:t,success:function(t){dataList=t,contolIndex=new root.controlIndex(t.length),bindEvent(),bindTouch(),$("body").trigger("play:change",0),renList()},error:function(){}})}function bindEvent(){$("body").on("play:change",function(t,o){audio.getAudio(dataList[o].audio),root.render(dataList[o]),"play"==audio.status&&(audio.play(),rotated(0)),$(".img-box").attr("data-deg",0),$(".img-box").css({transform:"rotateZ(0deg)",transition:"none"}),root.pro.renderAlltime(dataList[o].duration)}),$(".prev").on("click",function(t){changeSong("-")}),$(".next").on("click",function(t){changeSong("+")}),$(".play").on("click",function(t){"pause"==audio.status?(audio.play(),root.pro.start(),rotated($(".img-box").attr("data-deg")||0)):(audio.pause(),clearInterval(timer),root.pro.stop());$(".play").toggleClass("playing")}),$(".btn.list").on("click",function(t){$(".wrapper > .list").toggleClass("show")}),$("div.list").on("click",function(t){"LI"===t.target.tagName&&(changeSong($(t.target).index()),$(this).toggleClass("show"))})}function changeSong(t){var o=contolIndex.getIndex(t);$("body").trigger("play:change",o),root.pro.start(0),"pause"==audio.status&&(audio.pause(),root.pro.stop())}function rotated(t){clearInterval(timer),t=parseInt(t),timer=setInterval(function(){t+=2,$(".img-box").attr("data-deg",t),$(".img-box").css({transform:"rotateZ("+t+"deg)",transition:"transform 0.2s linear"})},200)}function bindTouch(){var t=$(".spot"),o=$(".pro-bottom").offset(),n=o.left,i=o.width;t.on("touchstart",function(){root.pro.stop()}).on("touchmove",function(t){var o=(t.changedTouches[0].clientX-n)/i;0<o&&o<1&&root.pro.update(o)}).on("touchend",function(t){var o=(t.changedTouches[0].clientX-n)/i;if(0<o&&o<1){var a=o*dataList[contolIndex.index].duration;$(".play").addClass("playing"),audio.playTo(a),audio.status="play",audio.play(),root.pro.start(o)}})}function renList(){var o="";dataList.map(function(t){return"<li>"+t.song+" - "+t.singer+"</li>"}).forEach(function(t){return o+=t}),$("div.list ul").html(o)}getData("../mock/data.json");